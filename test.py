import streamlit as st
from collections import Counter
import random
import streamlit.components.v1 as components
import json


# ตัวอย่าง: word + frequency
top_words = Counter(
{'คนร้าย': 12, 'สภ.เมืองอุดรธานี': 11, 'รถ': 10, 'เลี้ยว': 10, 'สืบสวน': 9, 'ตำรวจ': 8, 'ทอง': 6, 'มือ': 6, 'ซ้าย': 6, 'ถนน': 6, 'รถไฟ': 6, 'รางวัลนำจับ': 5, 'บาท': 5, 'อุดรธานี': 5, '18': 5, 'โจร': 5, 'อาชีพ': 5, 'ประชุม': 5, 'ก่อ': 5, 'ขวา': 5, 'สี': 5, '5': 4, 'หมื่น': 4, 'ชุด': 4, '"': 4, 'ไร้': 4, 'วี่แวว': 4, 'ผกก.': 4, 'เวลา': 4, 'บ้าน': 4, 'จอด': 4, 'ฮอนด้า': 4, 'คลิก': 4, 'เหลือง': 4, 'ยนต์': 4, 'เสื้อ': 4, 'ข้อมูล': 4, 'น.': 3, 'พ.ต.อ.พัฒนวงศ์ จันทร์พล': 3, 'ภ.จว.อุดรธานี': 3, 'คืบหน้า': 3, 'คดี': 3, 'โจรชิง': 3, 'เมืองอุดรธานี': 3, 'ขับ': 3, 'เส้นทาง': 3, 'สี่': 3, 'แยก': 3, 'หน้า': 3, 'จักรยาน': 3, 'ติด': 3, 'รุ่น': 3, 'ประสาน': 3, 'พื้นที่': 3, 'สงสัย': 3, 'ไรเดอร์': 2, 'ปืน': 2, 'ปลอม': 2, 'บุก': 2, 'เดี่ยว': 2, 'ชิง': 2, 'สาขา': 2, '1.1': 2, 'ล้าน': 2, '2568': 2, 'ห้อง': 2, 'ติดตาม': 2, '23': 2, 'บายพาสสกลนคร': 2, 'ตัว': 2, '...': 2, 'ทราบ': 2, '1': 2, 'รอบ': 2, 'เมือง': 2, 'บิ๊กซี': 2, 'จยย.': 2, 'ห้าง': 2, 'พ.ต.อ.พัฒนวงศ์': 2, 'หลบหนี': 2, 'ขี่': 2, 'ทะเบียน': 2, '2020': 2, 'ขบวน': 2, 'พาด': 2, 'ชุมชน': 2, '“': 2, 'จ.หนองคาย': 2, 'ทะลุ': 2, 'หมู่': 2, 'เขต': 2, '4': 2, 'ยี่ห้อ': 2, 'ตรวจสอบ': 2, 'บุคคล': 2, 'คน': 2, 'หมวก': 2, 'น็อก': 2, 'ภาพ': 2, 'รู้จัก': 2, 'ไล่': 1, 'ล่า': 1, 'สวม': 1, 'รูปพรรณ': 1, 'ร้านทองเยาวราช': 1, 'กรุงเทพฯ': 1, 'ระบุ': 1, '10.30': 1, '14': 1, 'พฤษภาคม': 1, 'กองกำกับ': 1, 'การสืบสวน': 1, 'โจรไรเดอร์': 1, 'ควง': 1, 'หนัก': 1, 'มูลค่า': 1, 'ร้าน': 1, 'ทองเยาวราชกรุงเทพ': 1, 'ชั้น': 1, '2': 1, 'ห้างบิ๊กซี': 1, 'แยกสันตพล': 1, 'ถนนนิตโย': 1, 'เขตเทศบาลนครอุดรธานี': 1, 'หนี': 1, 'ลอยนวล': 1, '19.15': 1, '26': 1, 'เมษายน': 1, 'กอง': 1, 'ภ.4': 1, 'หา': 1, 'วน': 1, 'ซอยเพชร': 1, 'น้ำ': 1, 'ใส': 1, 'หนองใส': 1, 'ทุ่ม': 1, 'แยกหนองใส': 1, 'เลียบ': 1, '19.03': 1, 'เดิน': 1, 'ประตู': 1, 'ฝั่ง': 1, 'บันได': 1, 'เลื่อน': 1, 'นาที': 1, 'ชิงเอา': 1, 'คล่องตัว': 1, 'แผ่น': 1, 'ป้าย': 1, 'ปี': 1, 'ตัวเมือง': 1, 'ตลาดหนองบัวแบบ': 1, 'ใจเย็น': 1, 'สาม': 1, 'เอกอุดร': 1, 'ทองใหญ่': 1, 'ศูนย์': 1, 'ค้ายูดี': 1, 'ทาวน์': 1, 'โรงเรียนเทศบาล ': 1, '7': 1, 'ข้าม': 1, 'หนองเหล็ก': 1, 'วัดป่าหนองแก้ว': 1, 'โฮมโปร': 1, 'แจ็กเก็ต': 1, 'ดำ': 1, 'ถนนสี่': 1, 'แยกอุโมงค์': 1, 'ระดับ': 1, 'ถนนมิตรภาพ': 1, 'มุ่งหน้า': 1, 'มัจฉา': 1, 'บ้านนา': 1, 'แยกเชียงพัง': 1, 'อ.บ้านผือ': 1, 'บ้านดู่': 1, 'ต.บ้านขาว': 1, 'อ.เมืองอุดรธานี': 1, 'สุดท้าย': 1, 'อำเภอเมือง': 1, 'อ.สระใคร': 1, 'หาย': 1, 'ตำรวจสืบสวน': 1, 'ติดต่อ': 1, 'กำนัน': 1, 'ปู': 1, 'พรม': 1, 'ค้นหา': 1, 'สำหรับ': 1, 'ทำ': 1, 'หนังสือ': 1, 'สอบถาม': 1, 'สมัคร': 1, 'พิรุธ': 1, 'เป้าหมาย': 1, 'พ้น': 1, 'โทษ': 1, 'จ.อุดรธานี': 1, '8,000': 1, 'พิสูจน์': 1, 'ญาติพี่น้อง': 1, 'ทยอย': 1, 'ใกล้เคียง': 1, 'หนองคาย': 1, 'หนองบัวลำภู': 1, 'แกร็บ': 1, 'เวียดนาม': 1, 'ซื้อขาย': 1, 'ออนไลน์': 1, 'ตรวจ': 1, 'ดีเอ็นเอ': 1, 'เทียบ': 1, 'กล้อง': 1, 'ตลาดหนองบัว': 1, 'ดู': 1, 'ประชาชน': 1, 'ท่าน': 1, 'ใด': 1, 'คลิป': 1, 'เครื่อง': 1, 'แต่ง': 1, 'กาย': 1, 'แจ้ง': 1, 'พ.ต.ท.บรรจง พาโคตร': 1, 'สว.': 1, 'สส.': 1, 'จับกุม': 1, 'ร้านทอง': 1, '50000': 1, '”': 1}
).most_common(50)



# Prepare data
data = [{"text": word, "size": freq * 10} for word, freq in top_words]

# Inject HTML + JS
components.html(f"""
<!DOCTYPE html>
<meta charset="utf-8">
<style>
    html, body {{
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: black;
        font-family: 'Sarabun', sans-serif;
    }}
    svg {{
        width: 100%;
        height: 100%;
    }}
    text {{
        cursor: pointer;
        user-select: text;
        font-family: 'Sarabun', sans-serif;
    }}
</style>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-cloud/build/d3.layout.cloud.min.js"></script>
<body>
<svg></svg>
<script>
var words = {json.dumps(data)};
var fill = d3.scaleOrdinal(d3.schemeCategory10);

// ใช้ขนาดหน้าจอจริง
var width = window.innerWidth;
var height = window.innerHeight;

d3.layout.cloud().spiral("rectangular")
    .size([width, height])
    .words(words)
    .padding(1)
    .rotate(() => 0)
    .fontSize(d => Math.min(d.size, 40))
    .on("end", draw)
    .start();

function draw(words) {{
  d3.select("svg")
    .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
    .selectAll("text")
    .data(words)
    .enter().append("text")
    .style("font-size", d => d.size + "px")
    .style("fill", (d, i) => fill(i))
    .attr("text-anchor", "middle")
    .attr("transform", d => "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")")
    .text(d => d.text);
}}
</script>
""", height=800)
